# This is a basic workflow to help you get started with Actions

name: Test CI / CD

on:
  push:
    branches: [ main ]
    
jobs:
  build:
    runs-on: self-hosted
   # env:
     # GOPATH: "/root/go"
  #    GO111MODULE: off
  #  defaults:
     # run:
     #   working-directory: ${{ env.GOPATH }}/src/github.com/${{ github.repository }}
    #steps:
   # - name: Checkout code
  #    uses: actions/checkout@v2
 #     with:
#        path: ${{ env.GOPATH }}/src/github.com/${{ github.repository }}
    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.16.x
      env :
        GOPATH: "/root/go"
        HOME: "/root"
        GOROOT: "/root/usr/local/go"
        GOCACHE: "/root/.cache/go-build"
        GO111MODULE: off

    - name: Export Go cache
      run: export GOCACHE=$GOCACHE
      
    - name: Export Go HOME
      run: export HOME=$HOME
      
    - name: Expor Go Path
      run: export GOPATH=$GOPATH
      
    - run: |
        export PATH=$PATH:$(go env GOPATH)/bin
        go get -u golang.org/x/lint/golint
        golint -set_exit_status ./...
      
   ## - name: Export GO111MODULE
     # run: export GO111MODULE=off

    - name: Build
      #run: go build -v ./...
      run: go build
    - name: Reload Daemon
      run: systemctl daemon-reload
      
    - name: restart test service
      run: systemctl restart cicdtest.service
